<div *ngIf="updateAvailable$ | async" class="notification-wrapper">
  <div (click)="fetchUpdate()" [class.visible]="updateAvailable$ | async" class="notification">
    <span>Neue Daten vorhanden <mat-icon>cached</mat-icon></span>
  </div>
</div>

<ng-container *ngIf="appointment$ | async as appointment; else loading">
  <app-appointment-data [appointment]="appointment"></app-appointment-data>

  <!--  <div *ngIf="userIsLoggedIn" id="telegramAuth">-->
  <!--    <script async src="https://telegram.org/js/telegram-widget.js?7"-->
  <!--            data-telegram-login="eca_cgh_bot"-->
  <!--            data-size="large"-->
  <!--            data-onauth="onTelegramAuth(user)"-->
  <!--            data-request-access="write"></script>-->
  <!--  </div>-->

  <ng-container *ngIf="enrollments.length > 0; else emptyList">
    <app-enrollment-list [appointment]="appointment" [distance]="false"
                         [enrollments]="enrollmentsCorrect" [title]="'Teilnehemer'"></app-enrollment-list>
    <app-enrollment-list [appointment]="appointment" [distance]="true"
                         [enrollments]="enrollmentsWaitingList" [title]="'Warteliste'"></app-enrollment-list>
    <app-enrollment-list [appointment]="appointment" [distance]="true"
                         [enrollments]="enrollmentsTooLate" [title]="'Zu spÃ¤t angemeldet'"></app-enrollment-list>
  </ng-container>

  <ng-template #emptyList>
    <div class="empty-list float">
      <span>Es hat sich noch niemand angemeldet.</span>
    </div>
  </ng-template>

  <mat-icon [queryParams]="{a: link}"
            [routerLink]="['/enroll/add']"
            class="floating-button right">
    person_add
  </mat-icon>
  <mat-icon *ngIf="appointment.driverAddition"
            [queryParams]="{a: link}"
            [routerLink]="['/appointment/driver']"
            class="floating-button left decent">
    directions_car
  </mat-icon>
</ng-container>

<ng-template #loading>
  <ng-container *ngIf="appointment === undefined; else loadingBar">
    <div class="error empty">
      <span>Sorry - 404</span>
      <img alt="anmeldesystem appointment not found robot icon" src="/assets/img/404.svg">
      Ich konnte diesen Termin nicht finden!
    </div>
  </ng-container>
</ng-template>

<ng-template #loadingBar>
  <mat-progress-bar
    [value]="percentDone"
    class="progress-bar"
    mode="determinate">
  </mat-progress-bar>
</ng-template>
