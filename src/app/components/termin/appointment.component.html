<ng-container *ngIf="appointment$ | async as appointment; else loading">

  <app-appointment-data [appointment]="appointment"></app-appointment-data>

  <div class="enrollment-list block decent"
       *ngIf="enrollments.length > 0 || getNumberOfActiveFilter() > 0; else emptyList">
    <div class="header">
      <h2 class="headline medium">Teilnehmer [{{appointment.enrollments.length}}{{appointment.maxEnrollments !== null
          ? '/' + appointment.maxEnrollments : ''}}]
        <span *ngIf="getNumberOfActiveFilter() > 0">
        [<mat-icon>filter_list</mat-icon>: {{enrollments.length}}]
      </span>
      </h2>
    </div>

    <mat-icon (click)="openFilterDialog()"
              matBadge="{{getNumberOfActiveFilter() > 0 ? getNumberOfActiveFilter() : ''}}"
              matBadgeColor="info"
              class="filter-open"
              matBadgeSize="small">
      filter_list
    </mat-icon>

    <mat-accordion *ngIf="enrollments.length > 0; else emptyListFilter">
      <ng-container *ngFor="let enrollment of enrollments">
        <mat-expansion-panel class="enrollment">
          <mat-expansion-panel-header class="enrollment-info"
                                      [collapsedHeight]="'auto'"
                                      [expandedHeight]="'auto'">
            <span>{{enrollment.name}}</span>
            <span class="separator small colored bolder high"></span>
            <span class="comment-block" *ngIf="enrollment.comment !== null">
            {{ enrollment.comment }}
          </span>
            <div class="addition-list" *ngIf="appointment.additions.length > 0">
            <span *ngIf="appointment.additions.length > 0 && enrollment.comment !== null"
                  class="separator small high"></span>
              <ng-container *ngFor="let addition of appointment.additions">
                <div>
                  <mat-icon *ngIf="findIndex(enrollment, addition.id) !== -1; else blank">
                    check_box
                  </mat-icon>
                  <ng-template #blank>
                    <mat-icon>
                      check_box_outline_blank
                    </mat-icon>
                  </ng-template>
                  <span>{{addition.name}}</span>
                </div>
              </ng-container>
            </div>
          </mat-expansion-panel-header>

          <div class="enrollment-additions">
            <mat-icon matBadge="{{enrollment.comments.length > 0 ? enrollment.comments.length : ''}}"
                      matBadgeColor="info"
                      matBadgeSize="small"
                      (click)="openCommentDialog(enrollment)">
              comment
            </mat-icon>
            <ng-container *ngIf="allowModify">
              <mat-icon>edit</mat-icon>
              <mat-icon>delete</mat-icon>
            </ng-container>
          </div>
        </mat-expansion-panel>
      </ng-container>
    </mat-accordion>

    <ng-template #emptyListFilter>
      <div class="empty-list">
        <mat-icon>search</mat-icon>
        <span>
        Dieser Filter liefert keine Ergebnisse
      </span>
      </div>
    </ng-template>
  </div>


  <ng-template #emptyList>
    <div class="empty-list float">
    <span>
        Es hat sich noch niemand angemeldet.
      </span>
    </div>
  </ng-template>

  <mat-icon [routerLink]="['/enroll/add']"
            class="floating-button right">
    person_add
  </mat-icon>

  <mat-icon [routerLink]="['/appointment/driver']"
            class="floating-button left decent">
    directions_car
  </mat-icon>
</ng-container>

<ng-template #loading>
  <mat-progress-bar mode="query">Lade Termin</mat-progress-bar>
</ng-template>
