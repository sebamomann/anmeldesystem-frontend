<ng-container *ngIf="appointment; else loading">

  <app-appointment-data [appointment]="appointment"></app-appointment-data>

  <!--  <div *ngIf="userIsLoggedIn" id="telegramAuth">-->
  <!--    <script async src="https://telegram.org/js/telegram-widget.js?7"-->
  <!--            data-telegram-login="eca_cgh_bot"-->
  <!--            data-size="large"-->
  <!--            data-onauth="onTelegramAuth(user)"-->
  <!--            data-request-access="write"></script>-->
  <!--  </div>-->

  <ng-container *ngIf="enrollments.length > 0; else emptyList">
    <div *ngIf="enrollmentsCorrect.length > 0 || getNumberOfActiveFilter() > 0;"
         class="enrollment-list block decent">
      <div class="header">
        <h2 class="headline medium">
          Teilnehmer [{{ enrollmentsCorrect.length }}{{ appointment.maxEnrollments !== null
          ? '/' + appointment.maxEnrollments : '' }}]
          <span *ngIf="getNumberOfActiveFilter() > 0">
        [<mat-icon>filter_list</mat-icon>: {{ enrollmentsCorrect.length }}]
      </span>
        </h2>
      </div>

      <!--    <div class="list-style">-->
      <!--      <mat-icon (click)="list = true">list</mat-icon>-->
      <!--      <mat-icon (click)="list = false">view_module</mat-icon>-->
      <!--    </div>-->

      <mat-icon (click)="_openFilterDialog()"
                class="filter-open"
                matBadge="{{getNumberOfActiveFilter() > 0 ? getNumberOfActiveFilter() : ''}}"
                matBadgeColor="info"
                matBadgeSize="small">
        filter_list
      </mat-icon>

      <mat-accordion *ngIf="enrollmentsCorrect.length > 0" [@listAnimation]>
        <ng-container *ngFor="let enrollment of enrollmentsCorrect">
          <mat-expansion-panel [@.disabled]="disableAnimation"
                               [ngClass]="list ? '' : 'small'"
                               class="enrollment">
            <mat-expansion-panel-header [collapsedHeight]="'auto'"
                                        [expandedHeight]="'auto'"
                                        class="enrollment-info">
              <span> {{ enrollment.name }} </span>
              <span class="separator small colored high"></span>
              <span *ngIf="enrollment.comment !== null" class="comment-block"> {{ enrollment.comment }} </span>
              <div *ngIf="appointment.additions.length > 0"
                   class="addition-list">
              <span *ngIf="appointment.additions.length > 0 && enrollment.comment !== null"
                    class="separator light small high">
              </span>
                <ng-container *ngFor="let addition of appointment.additions">
                  <div>
                    <mat-icon *ngIf="enrollmentCheckedAddition(enrollment, addition.id); else blank">check_box
                    </mat-icon>
                    <ng-template #blank>
                      <mat-icon>check_box_outline_blank</mat-icon>
                    </ng-template>
                    <span> {{ addition.name }} </span>
                  </div>
                </ng-container>
              </div>
            </mat-expansion-panel-header>

            <div class="enrollment-additions">
              <mat-icon
                (click)="_openCommentDialog(enrollment)"
                matBadge="{{enrollment.comments != null
                && enrollment.comments.length > 0
                  ? enrollment.comments.length
                  : ''}}"
                matBadgeColor="info"
                matBadgeSize="small">
                comment
              </mat-icon>
              <ng-container>
                <mat-icon (click)="precheckOpenConfirmationDialog(enrollment, 'edit')">edit</mat-icon>
                <mat-icon (click)="precheckOpenConfirmationDialog(enrollment, 'delete')">delete</mat-icon>
              </ng-container>
            </div>
          </mat-expansion-panel>
        </ng-container>
      </mat-accordion>
    </div>

    <div *ngIf="enrollmentsWaitingList.length > 0 || getNumberOfActiveFilter() > 0;"
         class="enrollment-list block decent">
      <div class="header">
        <h2 class="headline medium">
          Warteliste [{{ enrollmentsWaitingList.length }}{{ appointment.maxEnrollments !== null
          ? '/' + appointment.maxEnrollments : '' }}]
          <span *ngIf="getNumberOfActiveFilter() > 0">
        [<mat-icon>filter_list</mat-icon>: {{ enrollmentsWaitingList.length }}]
      </span>
        </h2>
      </div>

      <!--    <div class="list-style">-->
      <!--      <mat-icon (click)="list = true">list</mat-icon>-->
      <!--      <mat-icon (click)="list = false">view_module</mat-icon>-->
      <!--    </div>-->

      <mat-icon (click)="_openFilterDialog()"
                class="filter-open"
                matBadge="{{getNumberOfActiveFilter() > 0 ? getNumberOfActiveFilter() : ''}}"
                matBadgeColor="info"
                matBadgeSize="small">
        filter_list
      </mat-icon>

      <mat-accordion *ngIf="enrollmentsWaitingList.length > 0" [@listAnimation]>
        <ng-container *ngFor="let enrollment of enrollmentsWaitingList">
          <mat-expansion-panel [@.disabled]="disableAnimation"
                               [ngClass]="list ? '' : 'small'"
                               class="enrollment">
            <mat-expansion-panel-header [collapsedHeight]="'auto'"
                                        [expandedHeight]="'auto'"
                                        class="enrollment-info">
              <span> {{ enrollment.name }} </span>
              <span class="separator small colored high"></span>
              <span *ngIf="enrollment.comment !== null" class="comment-block"> {{ enrollment.comment }} </span>
              <div *ngIf="appointment.additions.length > 0"
                   class="addition-list">
              <span *ngIf="appointment.additions.length > 0 && enrollment.comment !== null"
                    class="separator light small high">
              </span>
                <ng-container *ngFor="let addition of appointment.additions">
                  <div>
                    <mat-icon *ngIf="enrollmentCheckedAddition(enrollment, addition.id); else blank">check_box
                    </mat-icon>
                    <ng-template #blank>
                      <mat-icon>check_box_outline_blank</mat-icon>
                    </ng-template>
                    <span> {{ addition.name }} </span>
                  </div>
                </ng-container>
              </div>
            </mat-expansion-panel-header>

            <div class="enrollment-additions">
              <mat-icon
                (click)="_openCommentDialog(enrollment)"
                matBadge="{{enrollment.comments != null
                && enrollment.comments.length > 0
                  ? enrollment.comments.length
                  : ''}}"
                matBadgeColor="info"
                matBadgeSize="small">
                comment
              </mat-icon>
              <ng-container>
                <mat-icon (click)="precheckOpenConfirmationDialog(enrollment, 'edit')">edit</mat-icon>
                <mat-icon (click)="precheckOpenConfirmationDialog(enrollment, 'delete')">delete</mat-icon>
              </ng-container>
            </div>
          </mat-expansion-panel>
        </ng-container>
      </mat-accordion>
    </div>

    <div *ngIf="enrollmentsTooLate.length > 0 || getNumberOfActiveFilter() > 0;"
         class="enrollment-list block decent">
      <div class="header">
        <h2 class="headline medium">
          Zu sp√§t angemeldet [{{ enrollmentsTooLate.length }}{{ appointment.maxEnrollments !== null
          ? '/' + appointment.maxEnrollments : '' }}]
          <span *ngIf="getNumberOfActiveFilter() > 0">
        [<mat-icon>filter_list</mat-icon>: {{ enrollmentsTooLate.length }}]
      </span>
        </h2>
      </div>

      <!--    <div class="list-style">-->
      <!--      <mat-icon (click)="list = true">list</mat-icon>-->
      <!--      <mat-icon (click)="list = false">view_module</mat-icon>-->
      <!--    </div>-->

      <mat-icon (click)="_openFilterDialog()"
                class="filter-open"
                matBadge="{{getNumberOfActiveFilter() > 0 ? getNumberOfActiveFilter() : ''}}"
                matBadgeColor="info"
                matBadgeSize="small">
        filter_list
      </mat-icon>

      <mat-accordion *ngIf="enrollmentsTooLate.length > 0" [@listAnimation]>
        <ng-container *ngFor="let enrollment of enrollmentsTooLate">
          <mat-expansion-panel [@.disabled]="disableAnimation"
                               [ngClass]="list ? '' : 'small'"
                               class="enrollment">
            <mat-expansion-panel-header [collapsedHeight]="'auto'"
                                        [expandedHeight]="'auto'"
                                        class="enrollment-info">
              <span> {{ enrollment.name }} </span>
              <span class="separator small colored high"></span>
              <span *ngIf="enrollment.comment !== null" class="comment-block"> {{ enrollment.comment }} </span>
              <div *ngIf="appointment.additions.length > 0"
                   class="addition-list">
              <span *ngIf="appointment.additions.length > 0 && enrollment.comment !== null"
                    class="separator light small high">
              </span>
                <ng-container *ngFor="let addition of appointment.additions">
                  <div>
                    <mat-icon *ngIf="enrollmentCheckedAddition(enrollment, addition.id); else blank">check_box
                    </mat-icon>
                    <ng-template #blank>
                      <mat-icon>check_box_outline_blank</mat-icon>
                    </ng-template>
                    <span> {{ addition.name }} </span>
                  </div>
                </ng-container>
              </div>
            </mat-expansion-panel-header>

            <div class="enrollment-additions">
              <mat-icon
                (click)="_openCommentDialog(enrollment)"
                matBadge="{{enrollment.comments != null
                && enrollment.comments.length > 0
                  ? enrollment.comments.length
                  : ''}}"
                matBadgeColor="info"
                matBadgeSize="small">
                comment
              </mat-icon>
              <ng-container>
                <mat-icon (click)="precheckOpenConfirmationDialog(enrollment, 'edit')">edit</mat-icon>
                <mat-icon (click)="precheckOpenConfirmationDialog(enrollment, 'delete')">delete</mat-icon>
              </ng-container>
            </div>
          </mat-expansion-panel>
        </ng-container>
      </mat-accordion>
    </div>
  </ng-container>
  <ng-template #emptyList>
    <div class="empty-list float">
      <span>Es hat sich noch niemand angemeldet.</span>
    </div>
  </ng-template>

  <mat-icon [queryParams]="{a: link}"
            [routerLink]="['/enroll/add']"
            class="floating-button right">
    person_add
  </mat-icon>
  <mat-icon *ngIf="appointment.driverAddition"
            [queryParams]="{a: link}"
            [routerLink]="['/appointment/driver']"
            class="floating-button left decent">
    directions_car
  </mat-icon>
</ng-container>

<ng-template #loading>
  <ng-container *ngIf="appointment === undefined; else loadingBar">
    <div class="error empty">
      <span>Sorry - 404</span>
      <img alt="anmeldesystem appointment not found robot icon" src="/assets/img/404.svg">
      Ich konnte diesen Termin nicht finden!
    </div>
  </ng-container>
</ng-template>

<ng-template #loadingBar>
  <mat-progress-bar
    [value]="percentDone"
    class="progress-bar"
    mode="determinate">
  </mat-progress-bar>
</ng-template>
